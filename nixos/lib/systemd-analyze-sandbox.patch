From 02655b7a49b1820ebf8ada96398cc98181ec7af7 Mon Sep 17 00:00:00 2001
From: benaryorg <binary@benary.org>
Date: Sat, 17 May 2025 01:26:12 +0000
Subject: [PATCH] analyze: redirect runtime directory to tmp

By redirecting to runtime directory to a temporary directory the tool is able to run in a build process/sandbox which may not have access to */run*.

Signed-off-by: benaryorg <binary@benary.org>
---
 src/analyze/analyze-verify-util.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/analyze/analyze-verify-util.c b/src/analyze/analyze-verify-util.c
index 40952531d7..b9fd2be255 100644
--- a/src/analyze/analyze-verify-util.c
+++ b/src/analyze/analyze-verify-util.c
@@ -15,6 +15,7 @@
 #include "manager.h"
 #include "pager.h"
 #include "path-util.h"
+#include "sd-path.h"
 #include "set.h"
 #include "string-table.h"
 #include "string-util.h"
@@ -311,6 +312,10 @@ int verify_units(
         if (r < 0)
                 return log_error_errno(r, "Failed to initialize manager: %m");
 
+        r = sd_path_lookup(SD_PATH_TEMPORARY, NULL, &m->prefix[EXEC_DIRECTORY_RUNTIME]);
+        if (r < 0)
+                return log_error_errno(r, "Failed to use temporary directory as runtime directory: %m");
+
         log_debug("Starting manager...");
 
         r = manager_startup(m, /* serialization= */ NULL, /* fds= */ NULL, root);
-- 
2.50.1

